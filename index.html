<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>国家领导人出席情况地图</title>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<style>
html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}
body {
    display: flex;
    overflow: hidden;
}
#mapContainer {
    flex: 1;           
    height: 100%;
}
#countryPanel {
    width: 300px;      
    height: 100%;
    background: #f9f9f9;
    padding: 20px;
    box-shadow: -5px 0 15px rgba(0,0,0,0.1);
    overflow-y: auto;
}
h2 {margin-top:0;}
.country-item {
    padding: 8px 12px;
    margin: 6px 0;
    background: white;
    border-radius: 6px;
    display: flex;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.country-color {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    margin-right: 10px;
}
</style>
</head>
<body>
<div id="mapContainer"></div>
<div id="countryPanel">
    <h2>出席国家列表</h2>
    <p>共 <strong id="countryCount">0</strong> 个国家</p>
    <div id="countryList"></div>
</div>

<script>
// 出席国家数据
const countriesData = [
    {name:'China', geoName:'China', value:1,label:'中国'},
    {name:'Russia', geoName:'Russia', value:2,label:'俄罗斯'},
    {name:'North Korea', geoName:'Dem. Rep. Korea', value:3,label:'朝鲜'},
    {name:'Cambodia', geoName:'Cambodia', value:4,label:'柬埔寨'},
    {name:'Vietnam', geoName:'Vietnam', value:5,label:'越南'},
    {name:'Laos', geoName:'Laos', value:6,label:'老挝'},
    {name:'Indonesia', geoName:'Indonesia', value:7,label:'印度尼西亚'},
    {name:'Malaysia', geoName:'Malaysia', value:8,label:'马来西亚'},
    {name:'Mongolia', geoName:'Mongolia', value:9,label:'蒙古国'},
    {name:'Pakistan', geoName:'Pakistan', value:10,label:'巴基斯坦'},
    {name:'Nepal', geoName:'Nepal', value:11,label:'尼泊尔'},
    {name:'Maldives', geoName:'Maldives', value:12,label:'马尔代夫'},
    {name:'Kazakhstan', geoName:'Kazakhstan', value:13,label:'哈萨克斯坦'},
    {name:'Uzbekistan', geoName:'Uzbekistan', value:14,label:'乌兹别克斯坦'},
    {name:'Tajikistan', geoName:'Tajikistan', value:15,label:'塔吉克斯坦'},
    {name:'Kyrgyzstan', geoName:'Kyrgyzstan', value:16,label:'吉尔吉斯斯坦'},
    {name:'Turkmenistan', geoName:'Turkmenistan', value:17,label:'土库曼斯坦'},
    {name:'Belarus', geoName:'Belarus', value:18,label:'白俄罗斯'},
    {name:'Azerbaijan', geoName:'Azerbaijan', value:19,label:'阿塞拜疆'},
    {name:'Armenia', geoName:'Armenia', value:20,label:'亚美尼亚'},
    {name:'Iran', geoName:'Iran', value:21,label:'伊朗'},
    {name:'Congo', geoName:'Congo', value:22,label:'刚果(布)'},
    {name:'Zimbabwe', geoName:'Zimbabwe', value:23,label:'津巴布韦'},
    {name:'Serbia', geoName:'Serbia', value:24,label:'塞尔维亚'},
    {name:'Slovakia', geoName:'Slovakia', value:25,label:'斯洛伐克'},
    {name:'Cuba', geoName:'Cuba', value:26,label:'古巴'},
    {name:'Myanmar', geoName:'Myanmar', value:27,label:'缅甸'}
];

// 随机颜色函数
function getRandomColor(){
    const letters='0123456789ABCDEF';
    let color='#';
    for(let i=0;i<6;i++) color+=letters[Math.floor(Math.random()*16)];
    return color;
}

// 每个国家颜色映射
const colorMap = {};
countriesData.forEach(c=>{
    colorMap[c.name] = c.value===1 ? '#ff4d4f' : getRandomColor();
});

// 初始化 ECharts
const chart = echarts.init(document.getElementById('mapContainer'));

// 加载世界地图 GeoJSON
fetch('./asset/geo/world.json')
.then(res=>res.json())
.then(worldJson=>{
    echarts.registerMap('world', worldJson);

    // 生成 mapData，包含所有国家
    const mapData = worldJson.features.map(f=>{
        const name = f.properties.name;
        const c = countriesData.find(c => c.geoName === name || c.name === name);
        return {
            name,
            // 注意：value不能为0，否则 itemStyle.areaColor可能不生效
            value: c ? c.value : 0.01,
            itemStyle: {
                areaColor: c ? colorMap[c.name] : '#f0f0f0'
            }
        };
    });

    // 配置 ECharts
    const option = {
        tooltip: {
            trigger:'item',
            formatter: params=>{
                const c = countriesData.find(c=>c.geoName===params.name || c.name===params.name);
                if(params.name==='China') return '<b>中国</b><br/>主办国';
                return c? `<b>${c.label}</b><br/>出席国家` : `<b>${params.name}</b>`;
            }
        },
        series:[{
            type:'map',
            map:'world',
            roam:true,
            label:{
                show:true,          // 默认显示国家名称
                color:'#000',
                fontSize:10,
                formatter:function(params){
                    const c = countriesData.find(c=>c.geoName===params.name || c.name===params.name);
                    return c ? c.label : params.name;
                }
            },
            emphasis:{
                label:{show:true,fontWeight:'bold',color:'#fff'},
                itemStyle:{areaColor:'#2a5caa'}
            },
            data:mapData
        }]
    };

    chart.setOption(option);

    // 生成右侧出席国家列表
    const countryListElement = document.getElementById('countryList');
    const attendingCountries = countriesData.filter(c=>c.value!==1);
    document.getElementById('countryCount').textContent = attendingCountries.length;
    attendingCountries.forEach(c=>{
        const item = document.createElement('div');
        item.className='country-item';
        item.innerHTML=`<div class="country-color" style="background-color:${colorMap[c.name]}"></div><span>${c.label}</span>`;
        countryListElement.appendChild(item);
    });

    // 窗口大小变化时自动 resize
    window.addEventListener('resize',()=>{chart.resize();});
})
.catch(err=>console.error('加载地图失败',err));
</script>
</body>
</html>
